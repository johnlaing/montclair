<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Montclair Question 2: The Two-Year Impact</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body { font-family: 'Segoe UI', Arial, sans-serif; background: #fdfdfd; padding: 20px; color: #333; line-height: 1.6; }
        .container { max-width: 1050px; margin: 0 auto; }
        .chart-box { border: 1px solid #eee; padding: 30px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); background: #fff; }
        h1 { text-align: center; margin-bottom: 5px; font-size: 28px; color: #2c3e50; }
        p.subtitle { text-align: center; color: #666; margin-bottom: 30px; font-size: 16px; max-width: 700px; margin-left: auto; margin-right: auto; }
        
        /* Legend */
        .legend-container { display: flex; justify-content: center; gap: 30px; margin-bottom: 20px; }
        .legend-item { display: flex; align-items: center; font-weight: bold; font-size: 15px; }
        .box-no { width: 20px; height: 20px; background: #518c6b; margin-right: 10px; border-radius: 4px; }
        .box-yes { width: 20px; height: 20px; background: #2980b9; margin-right: 10px; border-radius: 4px; }

        /* Chart Text */
        .bar-amount { font-size: 20px; font-weight: bold; text-anchor: middle; }
        .axis-text { font-size: 16px; font-weight: bold; fill: #2c3e50; }
        .zero-label { font-size: 13px; font-weight: bold; fill: #2c3e50; background: white; }
        .annotation { font-size: 13px; fill: #444; text-anchor: middle; font-weight: 500; }
        .cut-text { font-size: 13px; fill: #555; font-weight: bold; text-anchor: middle; }
        .alert-text { font-size: 13px; fill: #c0392b; font-weight: bold; }
    </style>
</head>
<body>

    <div class="container">
        <h1>The Impact of Question 2</h1>
        <p class="subtitle">Both options balance the budget this year. Next year, we remain in the red regardlessâ€”but the vote decides how deep the additional cuts will be.</p>

        <div class="legend-container">
            <div class="legend-item"><div class="box-no"></div> If we vote NO</div>
            <div class="legend-item"><div class="box-yes"></div> If we vote YES</div>
        </div>

        <div class="chart-box">
            <div id="dataviz"></div>
        </div>
    </div>

    <script>
        // Widened the canvas to 1000px to give text more horizontal room
        const width = 1000, height = 550;
        const margin = { top: 80, right: 40, bottom: 80, left: 60 };
        const innerWidth = width - margin.left - margin.right;
        const innerHeight = height - margin.top - margin.bottom;

        const svg = d3.select("#dataviz").append("svg")
            .attr("width", width)
            .attr("height", height)
            .append("g")
            .attr("transform", `translate(${margin.left},${margin.top})`);

        // Y-Axis
        const y = d3.scaleLinear().domain([-12, 6]).range([innerHeight, 0]);
        
        // X-Axis (Decreased padding to make the year sections wider)
        const x0 = d3.scaleBand().domain(["Year 1: 2025-26", "Year 2: 2026-27"]).range([0, innerWidth]).padding(0.08);
        
        // Sub-group X-Axis (Increased padding to push the bars further apart)
        const x1 = d3.scaleBand().domain(["no", "yes"]).range([0, x0.bandwidth()]).padding(0.3);

        // Add Y Axis
        svg.append("g").call(d3.axisLeft(y).ticks(9).tickFormat(d => (d < 0 ? "-$" + Math.abs(d) : "$" + d) + "M")).style("font-size", "12px");

        // The "ZERO" Line (Balanced Budget)
        const zeroY = y(0);
        
        // Shade the background above zero
        svg.append("rect").attr("x", 0).attr("y", 0).attr("width", innerWidth).attr("height", zeroY).attr("fill", "#f8f9fa").attr("opacity", 0.7);
        
        // Draw the zero line
        svg.append("line").attr("x1", 0).attr("x2", innerWidth).attr("y1", zeroY).attr("y2", zeroY).attr("stroke", "#2c3e50").attr("stroke-width", 3);
        
        // Balanced Budget label safely in the center
        svg.append("text").attr("class", "zero-label").attr("x", innerWidth / 2).attr("y", zeroY - 8).attr("text-anchor", "middle").text("Balanced Budget ($0)");

        // Add Year Labels
        const years = ["Year 1: 2025-26", "Year 2: 2026-27"];
        years.forEach(year => {
            svg.append("text").attr("class", "axis-text").attr("x", x0(year) + x0.bandwidth()/2).attr("y", innerHeight + 30).attr("text-anchor", "middle").text(year);
        });

        // Bottom text regarding midyear cuts
        svg.append("text").attr("class", "cut-text").attr("x", x0("Year 1: 2025-26") + x0.bandwidth()/2).attr("y", innerHeight + 55).text("These balances are over and above").append("tspan").attr("x", x0("Year 1: 2025-26") + x0.bandwidth()/2).attr("dy", "1.2em").text("the $2.8M mid-year cuts.");
        
        svg.append("text").attr("class", "cut-text").attr("x", x0("Year 2: 2026-27") + x0.bandwidth()/2).attr("y", innerHeight + 55).text("Both budget deficits are over and above").append("tspan").attr("x", x0("Year 2: 2026-27") + x0.bandwidth()/2).attr("dy", "1.2em").text("the $3.5M mid-year cuts.");

        // --- DRAW THE BARS & ANNOTATIONS ---
        
        // YEAR 1: 2025-26 
        const g2025 = svg.append("g").attr("transform", `translate(${x0("Year 1: 2025-26")},0)`);
        
        // No Bar 2025
        g2025.append("rect").attr("x", x1("no")).attr("y", zeroY - 4).attr("width", x1.bandwidth()).attr("height", 4).attr("fill", "#518c6b").attr("rx", 2);
        g2025.append("text").attr("class", "bar-amount").attr("x", x1("no") + x1.bandwidth()/2).attr("y", zeroY - 15).attr("fill", "#c0392b").text("$0");
        g2025.append("text").attr("class", "annotation").attr("x", x1("no") + x1.bandwidth()/2).attr("y", zeroY - 60).text("Balanced with").append("tspan").attr("x", x1("no") + x1.bandwidth()/2).attr("dy", "1.2em").text("$5.0M Advance Aid");

        // Yes Bar 2025
        g2025.append("rect").attr("x", x1("yes")).attr("y", zeroY - 4).attr("width", x1.bandwidth()).attr("height", 4).attr("fill", "#2980b9").attr("rx", 2);
        g2025.append("text").attr("class", "bar-amount").attr("x", x1("yes") + x1.bandwidth()/2).attr("y", zeroY - 15).attr("fill", "#1565c0").text("$0");
        g2025.append("text").attr("class", "annotation").attr("x", x1("yes") + x1.bandwidth()/2).attr("y", zeroY - 60).text("Balanced with").append("tspan").attr("x", x1("yes") + x1.bandwidth()/2).attr("dy", "1.2em").text("$5.0M Tax Levy");


        // YEAR 2: 2026-27 
        const g2026 = svg.append("g").attr("transform", `translate(${x0("Year 2: 2026-27")},0)`);

        // No Bar 2026 (-10M Gap)
        const gapNo = -10; 
        g2026.append("rect").attr("x", x1("no")).attr("y", zeroY).attr("width", x1.bandwidth()).attr("height", 0).attr("fill", "#518c6b").attr("rx", 4)
             .transition().duration(1500).ease(d3.easeCubicOut).attr("height", y(gapNo) - zeroY);
        
        g2026.append("text").attr("class", "bar-amount").attr("x", x1("no") + x1.bandwidth()/2).attr("y", y(gapNo) + 30).attr("fill", "#fff").attr("opacity", 0)
             .transition().delay(1000).duration(500).attr("opacity", 1).text("-$10.0M");
             
        // SAFELY BUILDING THE 'NO' TEXT (Moved higher up and stacked tightly)
        const annNo = g2026.append("text").attr("class", "annotation").attr("x", x1("no") + x1.bandwidth()/2).attr("y", zeroY - 95).attr("fill", "#c0392b").attr("opacity", 0);
        annNo.append("tspan").attr("x", x1("no") + x1.bandwidth()/2).text("1.85M Less State Aid");
        annNo.append("tspan").attr("x", x1("no") + x1.bandwidth()/2).attr("dy", "1.3em").text("due to advance 25/26 advance.");
        annNo.append("tspan").attr("x", x1("no") + x1.bandwidth()/2).attr("dy", "1.3em").attr("class", "alert-text").text("Need $10M");
        annNo.append("tspan").attr("x", x1("no") + x1.bandwidth()/2).attr("dy", "1.2em").attr("class", "alert-text").text("ADDITIONAL cuts.");
        annNo.transition().delay(1200).duration(500).attr("opacity", 1);


        // Yes Bar 2026 (-3.7M Gap)
        const gapYes = -3.7;
        g2026.append("rect").attr("x", x1("yes")).attr("y", zeroY).attr("width", x1.bandwidth()).attr("height", 0).attr("fill", "#2980b9").attr("rx", 4)
             .transition().duration(1500).ease(d3.easeCubicOut).attr("height", y(gapYes) - zeroY);
             
        g2026.append("text").attr("class", "bar-amount").attr("x", x1("yes") + x1.bandwidth()/2).attr("y", y(gapYes) + 30).attr("fill", "#fff").attr("opacity", 0)
             .transition().delay(1000).duration(500).attr("opacity", 1).text("-$3.7M");
             
        // SAFELY BUILDING THE 'YES' TEXT (Moved higher up and stacked tightly)
        const annYes = g2026.append("text").attr("class", "annotation").attr("x", x1("yes") + x1.bandwidth()/2).attr("y", zeroY - 95).attr("fill", "#1565c0").attr("opacity", 0);
        annYes.append("tspan").attr("x", x1("yes") + x1.bandwidth()/2).text("Tax Levy carries over.");
        annYes.append("tspan").attr("x", x1("yes") + x1.bandwidth()/2).attr("dy", "1.3em").attr("class", "alert-text").text("Need $3.7M");
        annYes.append("tspan").attr("x", x1("yes") + x1.bandwidth()/2).attr("dy", "1.2em").attr("class", "alert-text").text("ADDITIONAL cuts.");
        annYes.transition().delay(1200).duration(500).attr("opacity", 1);

        // Vertical Divider
        svg.append("line").attr("x1", innerWidth/2).attr("x2", innerWidth/2).attr("y1", -50).attr("y2", innerHeight + 20).attr("stroke", "#ccc").attr("stroke-dasharray", "4,4");

    </script>
</body>
</html>
